<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±æ–‡å–®å­—æ¶åœ°ç›¤å°æˆ° (Tic-Tac-Toe)</title>
    <style>
        :root {
            --p1-color: #3498db; /* Player 1 (O) Blue */
            --p2-color: #e74c3c; /* Player 2 (X) Red */
            --bg-color: #f4f7f6;
            --cell-bg: #ffffff;
            --text-main: #2c3e50;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
        }

        h1 {
            margin-bottom: 5px;
            font-size: 1.8rem;
            color: var(--text-main);
            text-align: center;
        }

        .subtitle {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 15px;
        }

        .status-bar {
            font-size: 1.3rem;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: white;
            border-radius: 50px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: inline-block;
        }

        /* æ£‹ç›¤æ¨£å¼ */
        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            background-color: #bdc3c7;
            padding: 12px;
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            max-width: 400px;
            width: 100%;
        }

        .cell {
            background-color: var(--cell-bg);
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            padding: 5px;
            cursor: pointer;
            border-radius: 8px;
            transition: transform 0.2s, background 0.2s;
            position: relative;
            user-select: none;
            word-break: break-word;
            color: #34495e;
        }

        .cell:hover:not(.taken) {
            transform: scale(1.02);
            background-color: #ecf0f1;
        }

        .cell.taken {
            cursor: default;
        }

        /* æ¨™è¨˜æ¨£å¼ (è¦†è“‹åœ¨æ–‡å­—ä¸Š) */
        .cell.taken span.word-text {
            opacity: 0.2; /* æ·¡åŒ–å–®å­— */
        }

        .cell .mark {
            position: absolute;
            font-size: 4rem;
            font-weight: 800;
            line-height: 1;
        }

        .mark.o { color: var(--p1-color); }
        .mark.x { color: var(--p2-color); }

        /* é‡æ–°é–‹å§‹æŒ‰éˆ• */
        .restart-btn {
            margin-top: 30px;
            padding: 12px 30px;
            font-size: 1rem;
            background-color: var(--text-main);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .restart-btn:hover { background-color: #1a252f; }

        /* é¸æ“‡é¡Œæ¨¡çµ„ (Modal) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(3px);
        }

        .modal-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 380px;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .question-word {
            font-size: 1.8rem;
            color: var(--text-main);
            margin-bottom: 20px;
            font-weight: bold;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .option-btn {
            padding: 12px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #555;
        }

        .option-btn:hover {
            border-color: var(--p1-color);
            background: #f0f8ff;
            color: var(--p1-color);
        }

        /* ç­”éŒ¯æ™‚çš„éœ‡å‹•å‹•ç•« */
        .shake {
            animation: shake 0.5s;
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        @media (max-width: 400px) {
            .cell { font-size: 0.85rem; }
            .cell .mark { font-size: 3rem; }
        }
    </style>
</head>
<body>

    <h1>è‹±æ–‡å–®å­—æ¶åœ°ç›¤</h1>
    <div class="subtitle">é»æ“Šå–®å­— âœ ç­”å°ä¸­æ–‡ âœ ä½”é ˜åœ°ç›¤</div>
    
    <div class="status-bar">
        <span class="player-indicator" id="playerColor" style="background: var(--p1-color);"></span>
        <span id="statusText">Player 1 (O) å›åˆ</span>
    </div>

    <div class="board" id="board">
        </div>

    <button class="restart-btn" onclick="initGame()">é‡æ–°æ´—ç‰Œ / é–‹å§‹æ–°å±€</button>

    <div class="modal-overlay" id="modal">
        <div class="modal-box" id="modalBox">
            <div class="question-word" id="modalWord">English</div>
            <div class="options-container" id="optionsContainer">
                </div>
            <div id="modalMsg" style="margin-top:10px; font-weight:bold; height: 1.2em; color: #e74c3c;"></div>
        </div>
    </div>

<script>
    // ==========================================
    // 1. å–®å­—è³‡æ–™åº« (åŒ…å«ä¸­æ–‡æ„æ€)
    // ==========================================
    const wordBank = [
        { word: "athlete", mean: "é‹å‹•å“¡" },
        { word: "athletic", mean: "é‹å‹•çš„" },
        { word: "muscle", mean: "è‚Œè‚‰" },
        { word: "workout", mean: "é‹å‹•ï¼Œè¨“ç·´" },
        { word: "routine", mean: "ä¾‹è¡Œå…¬äº‹" },
        { word: "peak", mean: "å·”å³° / æœ€ä½³çš„" },
        { word: "recovery", mean: "æ¢å¾©ï¼Œç—Šç™’" },
        { word: "recover", mean: "æ¢å¾©ï¼Œå¾©åŸ" },
        { word: "injury", mean: "å‚·å®³ï¼Œå—å‚·" },
        { word: "injure", mean: "å‚·å®³" },
        { word: "stiff", mean: "åƒµç¡¬çš„ / å …ç¡¬çš„" },
        { word: "Western", mean: "è¥¿æ–¹åœ‹å®¶çš„" },
        { word: "bandage", mean: "ç¹ƒå¸¶ / åŒ…ç´®" },
        { word: "swelling", mean: "è…«è„¹" },
        { word: "swell", mean: "è…«è„¹" },
        { word: "insert", mean: "æ’å…¥ï¼Œæ”¾é€²" },
        { word: "needle", mean: "é‡" },
        { word: "suck", mean: "å¸ / æŠ½å‡º" },
        { word: "smooth", mean: "æ»‘é †çš„ / æ’«å¹³" },
        { word: "doubt", mean: "æ‡·ç–‘" },
        { word: "doubtful", mean: "æ‡·ç–‘çš„" },
        { word: "circulation", mean: "å¾ªç’°" },
        { word: "circulate", mean: "å¾ªç’°ï¼Œæµå‹•" },
        { word: "circular", mean: "åœ“å½¢çš„" },
        { word: "reveal", mean: "æ­éœ² / å±•ç¾" },
        { word: "perform", mean: "åŸ·è¡Œ / è¡¨æ¼”" },
        { word: "performance", mean: "è¡¨æ¼”ï¼Œæ¼”å‡º" },
        { word: "stimulate", mean: "ä¿ƒé€²ï¼Œæ¿€ç™¼" },
        { word: "relieve", mean: "ç´“è§£ï¼Œè§£é™¤" },
        { word: "relief", mean: "å¯¬æ…°ï¼Œæ”¾å¿ƒ" },
        { word: "competition", mean: "ç«¶çˆ­" },
        { word: "compete", mean: "ç«¶çˆ­ï¼Œå°æŠ—" },
        { word: "competitive", mean: "ç«¶çˆ­çš„" },
        { word: "shorten", mean: "ç¸®çŸ­" },
        { word: "speed up", mean: "ä½¿â€¦åŠ é€Ÿ" },
        { word: "stem from", mean: "ç”±â€¦é€ æˆ" },
        { word: "result in", mean: "å°è‡´â€¦ç™¼ç”Ÿ" },
        { word: "engage in", mean: "åƒèˆ‡â€¦" },
        { word: "turn to", mean: "æ±‚åŠ©æ–¼â€¦" },
        { word: "at home", mean: "åœ¨å®¶è£¡" },
        { word: "make headlines", mean: "æˆç‚ºé ­æ¢æ–°è" }
    ];

    // ==========================================
    // 2. éŠæˆ²é‚è¼¯è®Šæ•¸
    // ==========================================
    let boardState = Array(9).fill(null); // å­˜æ”¾ä½”é ˜è€… 'O' æˆ– 'X'ï¼Œæœªä½”é ˜ç‚º null
    let boardWords = []; // å­˜æ”¾ç•¶å‰ç›¤é¢ä¸Šçš„ 9 å€‹å–®å­—ç‰©ä»¶
    let currentPlayer = "O"; // O = Player 1, X = Player 2
    let gameActive = true;
    let targetCellIndex = null; // ç•¶å‰æ­£åœ¨ä½œç­”çš„æ ¼å­ç´¢å¼•

    const statusText = document.getElementById('statusText');
    const playerColor = document.getElementById('playerColor');
    const boardElement = document.getElementById('board');
    const modal = document.getElementById('modal');
    const modalBox = document.getElementById('modalBox');
    const modalWord = document.getElementById('modalWord');
    const optionsContainer = document.getElementById('optionsContainer');
    const modalMsg = document.getElementById('modalMsg');

    const winningConditions = [
        [0, 1, 2], [3, 4, 5], [6, 7, 8],
        [0, 3, 6], [1, 4, 7], [2, 5, 8],
        [0, 4, 8], [2, 4, 6]
    ];

    // æ´—ç‰Œå‡½æ•¸
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    // åˆå§‹åŒ–éŠæˆ²
    function initGame() {
        boardState = Array(9).fill(null);
        gameActive = true;
        currentPlayer = "O";
        updateStatus();

        // éš¨æ©Ÿé¸ 9 å€‹å­—ä¸Šå ´
        const shuffledBank = shuffle([...wordBank]);
        boardWords = shuffledBank.slice(0, 9);

        renderBoard();
        closeModal();
    }

    // æ›´æ–°ç‹€æ…‹åˆ—
    function updateStatus() {
        if (!gameActive) return;
        if (currentPlayer === "O") {
            statusText.innerText = "Player 1 (O) å›åˆ";
            playerColor.style.background = "var(--p1-color)";
        } else {
            statusText.innerText = "Player 2 (X) å›åˆ";
            playerColor.style.background = "var(--p2-color)";
        }
    }

    // æ¸²æŸ“æ£‹ç›¤
    function renderBoard() {
        boardElement.innerHTML = "";
        boardWords.forEach((item, index) => {
            const cell = document.createElement('div');
            cell.classList.add('cell');
            
            // é¡¯ç¤ºå–®å­—
            const textSpan = document.createElement('span');
            textSpan.classList.add('word-text');
            textSpan.innerText = item.word;
            cell.appendChild(textSpan);

            // è‹¥å·²è¢«ä½”é ˜ï¼ŒåŠ ä¸Šæ¨™è¨˜
            if (boardState[index]) {
                cell.classList.add('taken');
                const mark = document.createElement('div');
                mark.classList.add('mark', boardState[index].toLowerCase());
                mark.innerText = boardState[index];
                cell.appendChild(mark);
            } else {
                // åªæœ‰æœªä½”é ˜çš„æ ¼å­å¯é»æ“Š
                cell.addEventListener('click', () => handleCellClick(index));
            }

            boardElement.appendChild(cell);
        });
    }

    // è™•ç†é»æ“Šæ ¼å­ -> è·³å‡ºé¡Œç›®
    function handleCellClick(index) {
        if (!gameActive || boardState[index]) return;
        targetCellIndex = index;
        showQuestion(boardWords[index]);
    }

    // é¡¯ç¤ºé¡Œç›®èˆ‡é¸é … (1 æ­£è§£ + 2 å¹²æ“¾)
    function showQuestion(targetObj) {
        modal.style.display = 'flex';
        modalWord.innerText = targetObj.word;
        modalMsg.innerText = "";
        modalBox.classList.remove('shake');
        optionsContainer.innerHTML = "";

        // ç”¢ç”Ÿå¹²æ“¾é¸é … (å¾é¡Œåº«ä¸­éš¨æ©Ÿæ‰¾ä¸æ˜¯æ­£ç¢ºç­”æ¡ˆçš„)
        const distractors = wordBank
            .filter(w => w.word !== targetObj.word)
            .sort(() => 0.5 - Math.random())
            .slice(0, 2);

        // çµ„åˆä¸¦æ´—ç‰Œé¸é …
        const options = shuffle([targetObj, ...distractors]);

        options.forEach(opt => {
            const btn = document.createElement('div');
            btn.classList.add('option-btn');
            btn.innerText = opt.mean;
            
            // åˆ¤æ–·æ˜¯å¦æ­£ç¢º
            if (opt.word === targetObj.word) {
                btn.onclick = () => handleAnswer(true);
            } else {
                btn.onclick = () => handleAnswer(false);
            }
            optionsContainer.appendChild(btn);
        });
    }

    // è™•ç†å›ç­”çµæœ
    function handleAnswer(isCorrect) {
        if (isCorrect) {
            // ç­”å°ï¼šä½”é ˜æ ¼å­
            boardState[targetCellIndex] = currentPlayer;
            renderBoard();
            checkResult();
            if (gameActive) {
                switchPlayer();
            }
            closeModal();
        } else {
            // ç­”éŒ¯ï¼šæ‡²ç½°æ©Ÿåˆ¶
            modalMsg.innerText = "ç­”éŒ¯äº†ï¼å›åˆå¼·åˆ¶çµæŸï¼";
            modalBox.classList.add('shake');
            
            // å»¶é² 1 ç§’å¾Œæ›æ‰‹ä¸¦é—œé–‰
            setTimeout(() => {
                switchPlayer();
                closeModal();
            }, 1200);
        }
    }

    function closeModal() {
        modal.style.display = 'none';
    }

    function switchPlayer() {
        currentPlayer = currentPlayer === "O" ? "X" : "O";
        updateStatus();
    }

    function checkResult() {
        let roundWon = false;
        for (let i = 0; i < winningConditions.length; i++) {
            const [a, b, c] = winningConditions[i];
            if (boardState[a] && boardState[a] === boardState[b] && boardState[a] === boardState[c]) {
                roundWon = true;
                break;
            }
        }

        if (roundWon) {
            statusText.innerText = `ğŸ† æ­å–œ Player ${currentPlayer === 'O' ? '1' : '2'} ç²å‹ï¼`;
            playerColor.style.background = "#f1c40f"; // Gold
            gameActive = false;
            return;
        }

        if (!boardState.includes(null)) {
            statusText.innerText = "ğŸ¤ å¹³æ‰‹ï¼éŠæˆ²çµæŸ";
            playerColor.style.background = "#95a5a6";
            gameActive = false;
            return;
        }
    }

    // å•Ÿå‹•éŠæˆ²
    initGame();

</script>
</body>
</html>